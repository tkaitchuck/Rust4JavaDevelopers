<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Lifetimes - Rust for Java developers</title>
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="A guide to learning Rust for developers familiar with Java">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "light" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="why_rust.html"><strong aria-hidden="true">1.</strong> Why Rust</a></li><li class="chapter-item expanded "><a href="history_of_rust.html"><strong aria-hidden="true">2.</strong> History of Rust</a></li><li class="chapter-item expanded "><a href="rust_community.html"><strong aria-hidden="true">3.</strong> The Rust Community</a></li><li class="chapter-item expanded "><a href="variable_declaration.html"><strong aria-hidden="true">4.</strong> Variable declaration</a></li><li class="chapter-item expanded "><a href="method_signatures.html"><strong aria-hidden="true">5.</strong> Method Signatures</a></li><li class="chapter-item expanded "><a href="flowcontrol.html"><strong aria-hidden="true">6.</strong> Flowcontrol</a></li><li class="chapter-item expanded "><a href="ownership.html"><strong aria-hidden="true">7.</strong> Ownership</a></li><li class="chapter-item expanded "><a href="objects.html"><strong aria-hidden="true">8.</strong> Objects and Traits</a></li><li class="chapter-item expanded "><a href="generics.html"><strong aria-hidden="true">9.</strong> Generics</a></li><li class="chapter-item expanded "><a href="collections.html"><strong aria-hidden="true">10.</strong> Collections</a></li><li class="chapter-item expanded "><a href="enums.html"><strong aria-hidden="true">11.</strong> Enums, tuples, and aliases</a></li><li class="chapter-item expanded "><a href="modules.html"><strong aria-hidden="true">12.</strong> Modules</a></li><li class="chapter-item expanded "><a href="cargo.html"><strong aria-hidden="true">13.</strong> Cargo</a></li><li class="chapter-item expanded "><a href="equivalent_frameworks.html"><strong aria-hidden="true">14.</strong> Equivalent frameworks</a></li><li class="chapter-item expanded "><a href="error_handling.html"><strong aria-hidden="true">15.</strong> Error handling</a></li><li class="chapter-item expanded "><a href="rust_makes_you_better_at_java.html"><strong aria-hidden="true">16.</strong> How Rust makes you a better Java programmer</a></li><li class="chapter-item expanded "><a href="concurrency.html"><strong aria-hidden="true">17.</strong> Concurrency</a></li><li class="chapter-item expanded "><a href="testing.html"><strong aria-hidden="true">18.</strong> Testing</a></li><li class="chapter-item expanded "><a href="debugging.html"><strong aria-hidden="true">19.</strong> Debugging</a></li><li class="chapter-item expanded "><a href="operator_overloading.html"><strong aria-hidden="true">20.</strong> Operator Overloading</a></li><li class="chapter-item expanded "><a href="lifetimes.html" class="active"><strong aria-hidden="true">21.</strong> Lifetimes</a></li><li class="chapter-item expanded "><a href="cool_rust_tricks.html"><strong aria-hidden="true">22.</strong> Cool Rust Tricks</a></li><li class="chapter-item expanded "><a href="writing_macros.html"><strong aria-hidden="true">23.</strong> Writing Mactos</a></li><li class="chapter-item expanded "><a href="command_line_programs.html"><strong aria-hidden="true">24.</strong> Command line programs</a></li><li class="chapter-item expanded "><a href="example_program.html"><strong aria-hidden="true">25.</strong> Example program</a></li><li class="chapter-item expanded "><a href="webasm.html"><strong aria-hidden="true">26.</strong> Webasm</a></li><li class="chapter-item expanded "><a href="rust_with_java.html"><strong aria-hidden="true">27.</strong> Using Rust with Java</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Rust for Java developers</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#lifetimes" id="lifetimes">Lifetimes</a></h1>
<p>Lifetimes are a way to specify additional information about borrows in order to convince the compiler that what you are
attempting to do makes sense. They will only effect whether or not code can compiler and have no effect on at runtime.</p>
<p>Consider the following code:</p>
<pre><pre class="playpen"><code class="language-rust">fn print_str_twice(string: &amp;str) {
    println!(&quot;{}  {}&quot;, string, string);
}
fn main() {
    let mut greeting = &quot;Hello&quot;.to_string();
    print_str_twice(&amp;greeting);
    greeting += &quot; world&quot;;
    println!(&quot;{}&quot;, greeting);
}
</code></pre></pre>
<p>Here the function <code>print_str_twice</code> borrows the argument <code>string</code>. Because the borrowed value cannot be held after the
function returns, and there is no return value from the function the compiler is able to work out that it's ok to modify
<code>greeting</code> on the next line.
But if the code looked like this:</p>
<pre><code class="language-rust ignore">fn get_tail_of_string(string: &amp;str) -&gt; &amp;str {
    &amp;string[1..]
}
fn main() {
    let mut greeting = &quot;Hello&quot;.to_string();
    let bad = get_tail_of_string(&amp;greeting);
    greeting += &quot; world&quot;;
    println!(&quot;{}&quot;, greeting);
    println!(&quot;Oops {}&quot;, bad);
}
</code></pre>
<p>This will generate a compile error because <code>greeting</code> is borrowed in <code>get_tail_of_string</code> and part of it is returned and
assigned to <code>bad</code>. This is a problem because <code>greeting</code> is modified on the next line, but <code>bad</code> ends up getting used later.</p>
<p>So how was the compiler so smart? The answer is that it automatically generated some <code>lifetimes</code> and applied them to the
method signature of <code>get_tail_of_string</code>.</p>
<p>When a method borrows parameters the compiler needs to track how long those borrows live so it can determine if code should
compile. This process works similar to generics. For example the method signature:</p>
<pre><pre class="playpen"><code class="language-rust skt-default">
<span class="boring">#![allow(unused_variables)]
</span><span class="boring">fn main() {
</span><span class="boring">trait Foo {
</span>  fn some_function&lt;T&gt;(arg1: &amp;T);
<span class="boring">}
</span><span class="boring">}
</span></code></pre></pre>
<p>is actually the same as:</p>
<pre><pre class="playpen"><code class="language-rust skt-default">
<span class="boring">#![allow(unused_variables)]
</span><span class="boring">fn main() {
</span><span class="boring">trait Foo {
</span>  fn some_function&lt;'a, T&gt;(arg1: &amp;'a T);
<span class="boring">}
</span><span class="boring">}
</span></code></pre></pre>
<p>Which means that the parameter <code>arg1</code> is borrowed for however long the value passed into arg1 lasts. Of course this is
a completely unnecessary statement, and hence can be simply omitted. (The naming convention is to start with ‘a for the
first parameter and then ‘b, 'c' etc. Lowercase letters are used to distinguish lifetime from normal type parameters like <code>T</code>)</p>
<p>However in the more complex case:</p>
<pre><pre class="playpen"><code class="language-rust skt-default">
<span class="boring">#![allow(unused_variables)]
</span><span class="boring">fn main() {
</span><span class="boring">struct Foo{a:str} struct Bar {}
</span>  fn some_function&lt;'a, 'b&gt;(arg1: &amp;'a Foo, arg2: &amp;'b Bar) -&gt; &amp;'a str
<span class="boring">{&amp;arg1.a}
</span><span class="boring">}
</span></code></pre></pre>
<p>Here the lifetime is meaningful and needs to be specified. Here the signature is providing the information that function
accepting two arguments <code>arg1</code> and <code>arg2</code> and these live however long the parameters passed as these values live, and the
return type lives as long as <code>arg1</code>. This means in this case that the return value is being derived from the first parameter
and not the second one. This will allow the compiler to check the calling code to make sure this is Ok.
(You don't need to know where the inputs came from or how long they will live. The compiler will just check everything.)</p>
<p>If the returned value were derived from the second parameter the function signature would look like:</p>
<pre><pre class="playpen"><code class="language-rust skt-default">
<span class="boring">#![allow(unused_variables)]
</span><span class="boring">fn main() {
</span><span class="boring">struct Foo{} struct Bar {a:str}
</span>  fn some_function&lt;'a, 'b&gt;(arg1: &amp;'a Foo, arg2: &amp;'b Bar) -&gt; &amp;'b str
<span class="boring">{&amp;arg2.a}
</span><span class="boring">}
</span></code></pre></pre>
<p>What if the result could be derived from either parameter and which one won't be know until run-time?
For example a function that returns the longer of two string slices. That would look like:</p>
<pre><pre class="playpen"><code class="language-rust skt-default">
<span class="boring">#![allow(unused_variables)]
</span><span class="boring">fn main() {
</span>  fn get_longer&lt;'a&gt;(arg1: &amp;'a str, arg2: &amp;'a str) -&gt; &amp;'a str
<span class="boring">{arg1}
</span><span class="boring">}
</span></code></pre></pre>
<p>In this case the compiler will infer a lifetime for 'a that must work for both parameters, and use this lifetime when
reasoning about the returned value.</p>
<p>In general the compiler is able to automatically figure out the lifetimes, and nothing needs to be specified. For example
with methods that are being invoked on an object such as:</p>
<pre><pre class="playpen"><code class="language-rust skt-default">
<span class="boring">#![allow(unused_variables)]
</span><span class="boring">fn main() {
</span>trait CharTrimmer {
  fn trim_chars(&amp;self, chars_to_remove: &amp;str) -&gt; &amp;str;
}
<span class="boring">}
</span></code></pre></pre>
<p>It is by default assumed that the source of any returned parameter is from the <code>self</code> argument. So the lifetimes would
be automatically inferred as:</p>
<pre><pre class="playpen"><code class="language-rust skt-default">
<span class="boring">#![allow(unused_variables)]
</span><span class="boring">fn main() {
</span>trait CharTrimmer {
  fn trim_chars&lt;'a&gt;(&amp;'a self, chars_to_remove: &amp;str) -&gt; &amp;'a str;
}
<span class="boring">}
</span></code></pre></pre>
<p>However if this is not the case, it can be clarified by specifying a different lifetime.</p>
<p>Lifetimes, only really come up when dealing with items that are being borrowed and parts are being passed out of the original called
either by a return value or embedding them in a struct, and never with owned items. So they tend to be a nitch feature.</p>
<p>For a much more complete exploration of the exotic cases of lifetimes see the post <a href="http://cglab.ca/%7Eabeinges/blah/too-many-lists/book/second-iter.html">&quot;Too many lists&quot;</a>.</p>
<table width="100%">
<tr>
<td> 
<p><img src="images/borrow.png" alt="Safety monitor" /></p>
</td>
<td width="80%">
<blockquote>
<p><em>Don't worry about making a mistake with lifetimes. If you declare lifetime to be too short or to long, I'll catch your mistake and show you the code path where it goes wrong. If it compiles it will do the right thing at runtime.</em></p>
</blockquote>
</td>
</tr>
</table>
<h2><a class="header" href="#static" id="static">'static</a></h2>
<p>There is one special lifetime: <code>'static</code>. This is used to indicate the reference can live for as long as the program is
running. For example when a constant string is defined:</p>
<pre><pre class="playpen"><code class="language-rust">fn main() {
  let greeting = &quot;Hello world!&quot;;
  //...
}
</code></pre></pre>
<p>the type of greeting is actually: <code>&amp;'static str</code>. Meaning that it is valid to hold onto <code>greeting</code> forever because the
string constant <code>&quot;Hello world!&quot;</code> will always be available. (Because string constants are part of the program itself
and hence by definition exist for the lifetime of the program. You can of course borrow them, and when you do they
have a static lifetime.) This is also be used as the lifetime for for statics and constants.</p>
<p>So if a function takes a 'static string such as:</p>
<pre><pre class="playpen"><code class="language-rust skt-default">
<span class="boring">#![allow(unused_variables)]
</span><span class="boring">fn main() {
</span>fn only_const_strings(arg: &amp;'static str)
<span class="boring">{}
</span><span class="boring">}
</span></code></pre></pre>
<p>This would restrict the values that can be passed into the method to only be string constants, or their derivatives.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="operator_overloading.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="cool_rust_tricks.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="operator_overloading.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="cool_rust_tricks.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        
        
        
        <script type="text/javascript">
            window.playpen_copyable = true;
        </script>
        

        
        <script src="ace.js" type="text/javascript" charset="utf-8"></script>
        <script src="editor.js" type="text/javascript" charset="utf-8"></script>
        <script src="mode-rust.js" type="text/javascript" charset="utf-8"></script>
        <script src="theme-dawn.js" type="text/javascript" charset="utf-8"></script>
        <script src="theme-tomorrow_night.js" type="text/javascript" charset="utf-8"></script>
        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
